<!DOCTYPE html>
<html lang="en-gb">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Energylog | nuney.com website</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="Displaying a log file (text file) in a Home Assistant Lovelace card This uses the standard Lovelace Webpage (iFrame) card to display text from a file. A simple webpage uses JScript to create a table with text file lines displayed in each row of the table. The web page refreshed every 60 seconds to update the displayed content.
This exanple creates and display a Home Assistant Notification log file with time-stamps, but any text file can be displayed with some minor modifications.">
    <meta name="generator" content="Hugo 0.123.7">
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



    

    
      

    

    

    
      <link rel="canonical" href="http://localhost:1313/posts/energylog/">
    

    <meta property="og:title" content="Energylog" />
<meta property="og:description" content="Displaying a log file (text file) in a Home Assistant Lovelace card This uses the standard Lovelace Webpage (iFrame) card to display text from a file. A simple webpage uses JScript to create a table with text file lines displayed in each row of the table. The web page refreshed every 60 seconds to update the displayed content.
This exanple creates and display a Home Assistant Notification log file with time-stamps, but any text file can be displayed with some minor modifications." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/posts/energylog/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-03-04T15:00:09+00:00" />
<meta property="article:modified_time" content="2024-03-04T15:00:09+00:00" />

<meta itemprop="name" content="Energylog">
<meta itemprop="description" content="Displaying a log file (text file) in a Home Assistant Lovelace card This uses the standard Lovelace Webpage (iFrame) card to display text from a file. A simple webpage uses JScript to create a table with text file lines displayed in each row of the table. The web page refreshed every 60 seconds to update the displayed content.
This exanple creates and display a Home Assistant Notification log file with time-stamps, but any text file can be displayed with some minor modifications."><meta itemprop="datePublished" content="2024-03-04T15:00:09+00:00" />
<meta itemprop="dateModified" content="2024-03-04T15:00:09+00:00" />
<meta itemprop="wordCount" content="723">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Energylog"/>
<meta name="twitter:description" content="Displaying a log file (text file) in a Home Assistant Lovelace card This uses the standard Lovelace Webpage (iFrame) card to display text from a file. A simple webpage uses JScript to create a table with text file lines displayed in each row of the table. The web page refreshed every 60 seconds to update the displayed content.
This exanple creates and display a Home Assistant Notification log file with time-stamps, but any text file can be displayed with some minor modifications."/>

	
  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        nuney.com website
      
    </a>
    <div class="flex-l items-center">
      

      
      
<div class="ananke-socials">
  
</div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Posts
      </aside>
      










  <div id="sharing" class="mt3 ananke-socials">
    
  </div>


      <h1 class="f1 athelas mt3 mb1">Energylog</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2024-03-04T15:00:09Z">March 4, 2024</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><h1 id="displaying-a-log-file-text-file-in-a-home-assistant-lovelace-card">Displaying a log file (text file) in a Home Assistant Lovelace card</h1>
<p>This uses the standard Lovelace Webpage (iFrame) card to display text from a file. A simple webpage uses JScript to create a table with text file lines displayed in each row of the table. The web page refreshed every 60 seconds to update the displayed content.</p>
<p>This exanple creates and display a Home Assistant Notification log file with time-stamps, but any text file can be displayed with some minor modifications.</p>
<h2 id="step-1---create-a-home-assistant-notify-file">Step 1 - Create a Home Assistant Notify file</h2>
<p>This yaml should be included in the Home Assistant configuration.yaml file to create the log file that will be displayed. In this case we are using the log file to record automation events and the log file entries will include a timestamp (this is processed by the JScript below).</p>
<pre tabindex="0"><code># Create log files for energy automation events
notify:
  - name: energy_log
    platform: file
    filename: /config/www/energylog.txt
    timestamp: true
</code></pre><h2 id="step-2---add-entries-to-the-log-file-using-the-home-assistant-notify-service">Step 2 - Add entries to the log file using the Home Assistant Notify service</h2>
<p>The following (action:) code can be added to a Home Assistant automation to add an event to logfile</p>
<pre tabindex="0"><code>action:
  - service: notify.energy_log
    data:
      message: This is a sample log file entry
</code></pre><h2 id="step-3---create-a-lovelace-webpage-card">Step 3 - Create a Lovelace Webpage card</h2>
<p>Use a Home Assistant Lovelace Web page card (type: iframe) that will display the content of an html file (created below)</p>
<pre tabindex="0"><code>type: iframe
url: /local/energylog.html
aspect_ratio: 100%
title: Energy Log File
</code></pre><h2 id="step-4---create-html-to-display-in-the-web-page-card">Step 4 - Create html to display in the web page card.</h2>
<p>The following html uses some straightforward JScript to read a text file (in this case a Home Assistant log file) and creates an html table.</p>
<h3 id="notes-on-the-code">Notes on the code</h3>
<p>The html meta/refresh reloads and updates the webpage every 60 seconds.</p>
<p>The file to read is specified as a URL parameter in the function call to the function &ldquo;GetTextFileLines&rdquo;. In addition to the required text file name, the URL includes the current date and time (&quot;/local/energylog.txt?&quot; + Date.now()) - the date and time information are not used by the function but they ensure that each URL is unique. This prevents Home Assistant from caching the page.</p>
<p>The number of lines that will be displayed in the Lovelace card is determined by the &ldquo;NumberOf Entries&rdquo; parameter. This purely configures the number of table rows that are displayed. It does not affect the number of file lines that are actually read (the script will read the entire text file on each call, so may be slow with very large files).</p>
<p>The direction of output is determined by the &ldquo;Direction&rdquo; parameter.</p>
<pre tabindex="0"><code>&lt;html&gt;
    &lt;meta http-equiv=&#34;refresh&#34; content=&#34;60&#34; /&gt;
    &lt;head&gt;
        &lt;title&gt;Log File&lt;/title&gt;

        &lt;style&gt;

            table, th, td {
                font-family: Arial, sans-serif;
                font-size:14px;
                border-collapse: collapse;
                border-bottom: 1px solid black;
                border-top: 1px solid black;
                vertical-align: top;
            }
            td:first-child {
                white-space: nowrap;   /* Keep date and time together on a single line*/
                text-align: right;
                padding-right: 10px;
            }

        &lt;/style&gt;

        &lt;script&gt;

            function FormatDatetime(DTString) {
                const DayNames = [&#34;Sun&#34;, &#34;Mon&#34;, &#34;Tue&#34;, &#34;Wed&#34;, &#34;Thu&#34;, &#34;Fri&#34;, &#34;Sat&#34;];
                let DT = new Date(DTString);
                return `${DayNames[DT.getDay()]} ${DT.getDate()}, ` +
                    `${(&#34;0&#34;+DT.getHours()).slice(-2)}:${(&#34;0&#34;+DT.getMinutes()).slice(-2)}:${(&#34;0&#34;+DT.getSeconds()).slice(-2)}`;
            }

            // Read the logfile and return entries in an HTML table
            // - Returns up to &#34;NumberOfEntries&#34; lines
            // - Entries are returned in order determined by &#34;Direction&#34; parameter

            function GetTextfileLines(FileUrl, NumberOfEntries, Direction) {

                let xmlHttp = new XMLHttpRequest();
                xmlHttp.open( &#34;GET&#34;, FileUrl, false );
                xmlHttp.send( null );
                let Lines = xmlHttp.responseText.split(&#34;\n&#34;);

                let LineCount = Lines.length;
                let LastLineIdx = LineCount -2;   // Last entry is displayed first. The last line of the file is blank, so subtract 2 to get last line index
                let FirstLineIdx =  Math.max(2, LineCount-NumberOfEntries-1);  // ...count backwards but stop before the header lines

                let TableString = &#34;&lt;table&gt;&#34;;
                // let TableString = &#34;&lt;table&gt;&lt;tr&gt;&lt;th&gt;Date&lt;/th&gt;&lt;th&gt;Event&lt;/th&gt;&lt;/tr&gt;&#34;;   // Table with Header Row

                if (Direction &gt; 0) {
                    for (let i = FirstLineIdx; i &lt;= LastLineIdx; i++) {
                        let SplitLine = Lines[i].split(/(?&lt;=^\S+)\s/);       // Split on first space
                        TableString += &#34;&lt;tr&gt;&lt;td&gt;&#34; + FormatDatetime(SplitLine[0]) + &#34;&lt;/td&gt;&lt;td&gt;&#34; + SplitLine[1] + &#34;&lt;/td&gt;&lt;/tr&gt;&#34;;
                    }
                } else {
                    for (let i = LastLineIdx; i &gt;= FirstLineIdx; i--) {
                        let SplitLine = Lines[i].split(/(?&lt;=^\S+)\s/);       // Split on first space
                        TableString += &#34;&lt;tr&gt;&lt;td&gt;&#34; + FormatDatetime(SplitLine[0]) + &#34;&lt;/td&gt;&lt;td&gt;&#34; + SplitLine[1] + &#34;&lt;/td&gt;&lt;/tr&gt;&#34;;
                    }
                }

                return TableString + &#34;&lt;/table&gt;&#34;;
            }

        &lt;/script&gt;
    &lt;/head&gt;

    &lt;body&gt;

        &lt;script&gt;

            // Read up to 10 most recent lines from the Energy logfile and display as a table
            document.write(GetTextfileLines(&#34;/local/energylog.txt?&#34; + Date.now(), 14, 1));

        &lt;/script&gt;

    &lt;/body&gt;
&lt;/html&gt;
</code></pre><ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://localhost:1313/" >
    &copy;  nuney.com website 2024 
  </a>
    <div>
<div class="ananke-socials">
  
</div>
</div>
  </div>
</footer>

  </body>
</html>
